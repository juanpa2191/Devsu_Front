<div class="movimiento-form-container">
  <h2>{{ isEditMode ? 'Editar Movimiento' : 'Crear Movimiento' }}</h2>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>

  <form [formGroup]="movimientoForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <div class="form-row">
      <div class="form-group">
        <label for="tipoMovimiento">Tipo de Movimiento:</label>
        <select
          id="tipoMovimiento"
          formControlName="tipoMovimiento"
          class="form-control"
          [class.error]="movimientoForm.get('tipoMovimiento')?.invalid && movimientoForm.get('tipoMovimiento')?.touched">
          <option *ngFor="let tipo of tiposMovimiento" [value]="tipo.value">{{ tipo.label }}</option>
        </select>
        <div *ngIf="movimientoForm.get('tipoMovimiento')?.invalid && movimientoForm.get('tipoMovimiento')?.touched" class="error-text">
          {{ getErrorMessage('tipoMovimiento') }}
        </div>
      </div>

      <div class="form-group">
        <label for="cuentaId">Cuenta:</label>
        <select
          id="cuentaId"
          formControlName="cuentaId"
          class="form-control"
          [class.error]="movimientoForm.get('cuentaId')?.invalid && movimientoForm.get('cuentaId')?.touched">
          <option value="">Seleccione una cuenta</option>
          <option *ngFor="let cuenta of cuentas" [value]="cuenta.id">
            {{ cuenta.numeroCuenta }} - {{ cuenta.cliente?.nombre }}
          </option>
        </select>
        <div *ngIf="movimientoForm.get('cuentaId')?.invalid && movimientoForm.get('cuentaId')?.touched" class="error-text">
          {{ getErrorMessage('cuentaId') }}
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="valor">Valor:</label>
      <input
        type="number"
        id="valor"
        formControlName="valor"
        placeholder="0.00"
        step="0.01"
        class="form-control"
        [class.error]="movimientoForm.get('valor')?.invalid && movimientoForm.get('valor')?.touched">
      <div *ngIf="movimientoForm.get('valor')?.invalid && movimientoForm.get('valor')?.touched" class="error-text">
        {{ getErrorMessage('valor') }}
      </div>
    </div>

    <div *ngIf="movimientoForm.get('cuentaId')?.value" class="saldo-info">
      <p><strong>Saldo Disponible:</strong> ${{ saldoDisponible }}</p>
      <p *ngIf="movimientoForm.get('tipoMovimiento')?.value === 2 && movimientoForm.get('valor')?.value">
        <strong>Saldo Después del Retiro:</strong> ${{ calcularNuevoSaldo() }}
      </p>
      <p *ngIf="movimientoForm.get('tipoMovimiento')?.value === 1 && movimientoForm.get('valor')?.value">
        <strong>Saldo Después del Depósito:</strong> ${{ calcularNuevoSaldo() }}
      </p>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="movimientoForm.invalid">
        {{ isEditMode ? 'Actualizar' : 'Crear' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancelar</button>
    </div>
  </form>

  <div *ngIf="loading" class="loading">
    {{ isEditMode ? 'Cargando movimiento...' : 'Guardando...' }}
  </div>
</div>